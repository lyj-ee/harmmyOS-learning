##### 创建进程组
- 从内存池中分配进程组结构体
- 初始化进程链表
- 初始化退出进程链表
- 设置进程所属进程组
- 设置leader进程
- 将进程组添加到全局进程组链表

##### 退出进程组
- 找到进程组的组长进程
- 从进程组进程链表删除进程


##### 进程模块初始化
- 创建进程池，进程池默认最大可容纳64个进程
- 初始化进程空闲链表和进程回收链表
- 将进程池中所有的进程设置进程ID，ID为进程在进程池的下标
- 设置进程池中所有的进程为未使用状态
- 将进程池中每个进程的阻塞链表的结点添加到空闲进程链表
```
空闲进程链表上挂的是每个进程的阻塞链表节点
```
- 设置idle进程，用户根进程和内核跟进程的ID分别为0，1，2，并将这三个进程从空闲链表中摘除

``
在初始化进程模块之后可以看到，进程池中只有[3, processMaxNum-1]号进程.
idle进程是cpu空闲进程
所有的用户进程都由用户根进程（PID为1）fork得到，所有的内核进程都由内核根进程（PID为2）fork得到，并且都需要从空闲进程链表中申请PCB
``

##### 进程回收再利用
- 从进程回收列表中逐个找到所有的带有退出标志的进程实体
- 将所有的任务（task）从回收列表转移到空闲列表，以便再分配使用
- 将进程的退出标志删除
- 如果是用户态进程需释放进程的虚拟内存
- 将进程从进程链表上摘除
- 如果进程是进程组组长或者处于僵尸态，则将进程挂回到进程回收链表上
```组长进程不能被回收```

```
进程的回收再利用整个过程使用了一个自旋锁
```

##### 删除PCB
- 回收进程资源
- 将进程从兄弟链表中删除
- 退出进程组
- 设置进程状态为非初始化和退出
- 将进程挂到回收链表中


##### 回收指定进程的资源
- 初始化状态的进程没有使用资源不回收，正在运行的进程不回收资源
- 如果是用户进程，删除与进程相关的文件
- 删除用户
- 回收进程使用的定时器
- 如果是用户进程，删除进程对lite IPC的开销  ？？？


##### 回收僵尸状态进程的资源
- 退出进程组
- 退出父进程的子进程链表
- 删除僵尸态标志（如果有），并标记成未使用状态
- 退出本进程的阻塞链表
- 插入到回收进程链表，如果有退出标志则插入到头部，如果是一个组长进程就插入到尾部，尽量延后处理。
- 如果没有退出标志也不是组长进程，则插入到空闲链表中，以便重新分配使用


##### 进程的自然退出时子进程的处理
如果存在子进程则将所有的子进程挂到相应的内核态或用户态的根进程下，作为根进程的子进程


##### 进程的自然退出过程
- 通过当前运行的任务找到对应的正在运行的进程
- 释放子进程的资源
- 如果有父进程则自己从兄弟链表中摘除并设置进程退出码，同时挂到父进程的退出子进程链表
- 退出进程组，同时挂到进程组的退出链表
- 检查父进程的等待任务链表并唤醒对应的任务,此处将会频繁的切到其他任务运行.
- 子进程要怎么处理,移交给(用户态和内核态)根进程
- 进程状态加上僵死状态
- 以内核权限发送SIGCHLD(子进程退出)信号
- 将进程挂入全局进程回收链表
- 删除正在运行的任务

##### 初始化PCB块
- 指定进程的模式，优先级和进程名
- 初始化进程的线程链表，子进程链表，退出子进程链表和等待链表
- 如果是用户进程需分配内存空间


##### 创建用户
- 需指定用户ID，组ID和组数量


##### 进程的创建并初始化
- 创建PCB块
- 用户模式下的PCB块的IPC池需初始化
- 分配进程的文件管理器
- 创建进程组
- 创建用户


##### 创建IDEL进程和内核根进程
- 初始化进程模块
- 从进程池中获取2号进程（内核态根进程）PCB块，创建该进程并将其初始化
- 去掉根进程的初始化标签
- 全局进程组初始化为跟进程的进程组，并初始化全局进程组链表
- 将被创建的根进程设置为当前进程
- 创建资源回收任务
- 获取进程池中0号进程（IDLE进程）PCB，创建并初始化该进程
- IDLE进程的父进程设置为2号进程，并与其共享用户和文件
- 创建CPU的IDLE任务，从此CPU便有了空闲任务
- 将IDLE进程的线程组ID设置为IDLE任务ID


将任务挂入进程的waitList链表,表示这个任务在等待某个进程的退出